% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/loglik.R
\name{loglik}
\alias{loglik}
\title{Maximum Likelihood Estimation with Sandwich Covariance}
\usage{
loglik(
  fun,
  fun_vars = NULL,
  parameter_info,
  data,
  trace = TRUE,
  control = loglik_control(),
  n = NULL
)
}
\arguments{
\item{fun}{Function. Likelihood function (not log-likelihood).}

\item{fun_vars}{Named character vector. Name(s) of primary variables for function;
names should be column names in data.}

\item{parameter_info}{Object of class \code{parameter_info} from \code{create_parameter_info()}.}

\item{data}{Data frame or matrix with all analysis variables, or NULL to use
parameter_info$model_data.}

\item{trace}{Logical. If TRUE, print iteration progress (default: TRUE).}

\item{control}{List from \code{\link{loglik_control}} with optimization settings.}

\item{n}{Character or NULL. Name of frequency/count variable (if data are aggregated).}
}
\value{
Object of class "loglik" with the fitted model results and diagnostics.
See \code{\link{loglik_fit}} for detailed component descriptions.
}
\description{
Fits parameters via Newton-Raphson, Levenberg, or Marquardt optimization,
with automatic differentiation, parameter constraints, and robust standard errors.
}
\details{
The optimization algorithm solves the likelihood equations iteratively using
one of three methods (Newton-Raphson, Levenberg-Marquardt, Marquardt) with
convergence assessed using specified criteria (parameter change, gradient norm,
log-likelihood change, or combinations thereof).

\strong{Parameter bounds}: Parameters are automatically constrained to their specified
bounds during optimization. If a parameter converges to its bound, this indicates
potential issues with model specification or data identification - a warning will
be issued. Use \code{\link{check_boundary_parameters}} for detailed inspection.

\strong{Link functions}: Parameters can be transformed using link functions (e.g., "log",
"logit") specified in \code{parameter_info}. This allows fitting parameters on
different scales.

\strong{Design matrices}: If \code{parameter_info} contains formulas, design matrices
expand parameters across factor levels or covariate values automatically.

\strong{Sandwich covariance}: Robust (sandwich) standard errors are computed from the
gradient (score) matrix. Use \code{\link{vcov_sandwich.loglik}} for robust inference.
}
\note{
\strong{Boundary warnings}: If any parameter converges to its lower or upper bound,
a warning is issued. This typically indicates:
\itemize{
\item Bounds may be too restrictive
\item Parameters may not be well-identified
\item Model formulation may need review
}
Inspect using \code{\link{check_boundary_parameters}} for details.

\strong{Missing fit information}: If convergence fails or numerical issues occur,
some results (e.g., Hessian) may be invalid. Check \code{$converged} status.
}
\examples{
\dontrun{
# Fit a Weibull model with group-specific shape parameters
data <- data.frame(
  x = rweibull(100, shape = 2, scale = 5),
  group = rep(c("A", "B"), each = 50)
)

param_info <- create_parameter_info(
  parameter_values = c(k = 2, lambda = 5),
  estimate_flag = c(k = 1, lambda = 1),
  lower_bounds = c(k = 0.01, lambda = 0.01),
  upper_bounds = c(k = 100, lambda = 100),
  formulas = list(k = ~0 + group, lambda = ~1),
  model_data = data
)

fit <- loglik(
  fun = dweibull,
  fun_vars = c(x = "x"),
  parameter_info = param_info,
  data = data,
  trace = TRUE
)

summary(fit)
check_boundary_parameters(fit)
}

}
\references{
For model selection: Burnham, K.P. and Anderson, D.R. (2002) Model selection
and multimodel inference: a practical information-theoretic approach. 2nd ed.
Springer-Verlag, New York. DOI: 10.1007/b97636
}
