% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/create_parameter_design.R
\name{create_parameter_design}
\alias{create_parameter_design}
\title{Create Design of Experiments for Parameter Space Exploration}
\usage{
create_parameter_design(
  parameter_info,
  generators = NULL,
  alpha = "rotatable",
  center_points = 1,
  infinite_range_factor = 2
)
}
\arguments{
\item{parameter_info}{Object of class \code{parameter_info} from
\code{create_parameter_info()}. Must have reasonable (non-infinite) bounds
or current parameter values will be used to define ranges.}

\item{generators}{Character vector or NULL. Generator definitions for fractional
factorial design in terms of expanded parameter names (e.g., "k.B=k.A*lambda.A").
If NULL, creates full factorial. See \code{\link{fractional_factorial_design}}
for generator syntax.}

\item{alpha}{Character or numeric. Distance of axial points from center:
\itemize{
\item "rotatable" (default) - ensures rotatability
\item "faces" - face-centered design (3 levels only)
\item Numeric - custom alpha value
}}

\item{center_points}{Integer. Number of center point replicates. Default is 1
(typically sufficient for initial value search). Use more (4-6) for response
surface fitting.}

\item{infinite_range_factor}{Numeric. For parameters with infinite bounds,
defines range as \code{[value/factor, value*factor]} for positive values, or
\code{[value*factor, value/factor]} for negative values. Default 2.}
}
\value{
Data frame with the parameter space design containing:
\itemize{
\item One column per expanded parameter (e.g., "kA", "kB", "lambdaA", "lambdaB")
\item Values in original parameter scale (not coded units)
\item "point_type" column: "factorial", "axial", or "center"
\item Attributes: design_type, num_parameters, parameter_names, bounds_used
}
}
\description{
Generates a Central Composite Design (CCD) in parameter space based on
\code{parameter_info} bounds. The design can be used to explore the
log-likelihood surface and find good initial parameter estimates through
systematic evaluation of the parameter space.
}
\details{
This function creates a rotatable or face-centered CCD for exploring the
parameter space defined by a \code{parameter_info} object. The design:
\itemize{
\item Uses lower and upper parameter bounds to define the design region
\item Creates a fractional factorial design in coded units (-1, +1)
\item Adds axial (star) points at ±α distance from center
\item Adds center point(s) for curvature estimation
\item Transforms coded values back to original parameter scale
}

\strong{Use Cases:}
\itemize{
\item \strong{Initial value search}: Evaluate log-likelihood at design points to
find good starting values for optimization
\item \strong{Likelihood surface visualization}: Map the response surface of
log-likelihood
\item \strong{Parameter sensitivity}: Identify which parameters most affect
log-likelihood
\item \strong{Multi-start optimization}: Use design points as multiple starting
values for optimization
}

\strong{Coding and Scaling:}
The design is created in coded units (-1 to +1), then transformed to the
original parameter scale using:
\deqn{x_{real} = \frac{x_{coded} \times (upper - lower)}{2} + \frac{upper + lower}{2}}

\strong{Handling Infinite Bounds:}
Parameters with infinite bounds (±Inf) are handled by:
\itemize{
\item Using current parameter value as center
\item Creating symmetric range based on \code{infinite_range_factor}
\item Default factor of 2 means range = \code{[value-delta, value+delta]} for positive values
}
delta logic
\itemize{
\item Both ±Inf:    delta = \code{|value|/infinite_range_factor}
\item Lower -Inf:   delta = \code{min(upper-value, |value|/infinite_range_factor)}
\item Upper +Inf:   delta = \code{min(value-lower, |value|/infinite_range_factor)}
}
}
\note{
\strong{Parameter expansion}: If parameter_info contains formulas creating multiple
coefficients (e.g., k with formula ~0+group creates kA and kB), the design
includes all expanded parameters.

\strong{Bounds validation}: The function will warn if:
\itemize{
\item Any bound is infinite and must be estimated
\item Bounds are very wide (range > 1000)
\item Bounds are very narrow (range < 0.01)
}

\strong{Design size}: Total runs = \eqn{n_f + 2k + n_c} where:
\itemize{
\item \eqn{n_f} = factorial points (2^k or 2^(k-p) if generators used)
\item \eqn{k} = number of parameters
\item \eqn{n_c} = center points
}
}
\examples{
\dontrun{
# Example 1: Simple 2-parameter design
param_info <- create_parameter_info(
  parameter_values = c(k = 2, lambda = 10),
  lower_bounds = c(k = 0.5, lambda = 5),
  upper_bounds = c(k = 5, lambda = 20),
  estimate_flag = c(k = 1, lambda = 1)
)

design <- create_parameter_design(param_info)
print(design)
# Returns CCD with k and lambda in original scale

# Example 2: With parameter expansion (formulas)
data <- data.frame(group = factor(c("A", "B", "A", "B")))
param_info <- create_parameter_info(
  parameter_values = c(k = 2, lambda = 10),
  formulas = list(k = ~0 + group, lambda = ~0 + group),
  lower_bounds = c(k = 0.5, lambda = 5),
  upper_bounds = c(k = 5, lambda = 20),
  model_data = data
)

# Now have 4 parameters: kA, kB, lambdaA, lambdaB
design <- create_parameter_design(
  param_info,
  generators = "lambdaB=kA*kB*lambdaA"  # 2^(4-1) design
)

# Example 3: Face-centered for limited levels
design_fccd <- create_parameter_design(
  param_info,
  alpha = "faces",
  center_points = 3
)

# Example 4: Use design for initial value search
# Evaluate log-likelihood at each design point
design$loglik <- apply(design[, 1:4], 1, function(pars) {
  # Update parameter_info with design values
  param_info$parameter_values <- as.list(pars)
  # Compute log-likelihood
  ll <- compute_loglik(param_info, data)
  return(ll)
})

# Find best starting point
best_idx <- which.max(design$loglik)
initial_values <- design[best_idx, 1:4]
}

}
\references{
Box, G.E.P. and Draper, N.R. (2007) Response Surfaces, Mixtures, and Ridge
Analyses, 2nd ed. Wiley.

Jones, B. and Nachtsheim, C.J. (2011) Efficient Designs With Minimal
Aliasing. Technometrics, 53(1), 62-71.
}
\seealso{
\code{\link{fractional_factorial_design}} for creating the base factorial design

\code{\link{augment_with_star_center_points}} for adding star and center points

\code{\link{create_parameter_info}} for parameter structure
}
